<section class="detalle">
  <header class="detalle__header">
    <div>
      <p class="kicker">Rutina</p>
      <h1 *ngIf="rutina; else cargandoTpl">{{ rutina.nombre }}</h1>
      <ng-template #cargandoTpl><h1>Cargando rutina...</h1></ng-template>
      <p class="meta" *ngIf="rutina">Creada por {{ rutina.creador }}</p>
    </div>
    <div class="acciones">
      <button class="btn ghost" type="button" (click)="volver()">Volver</button>
      <button class="btn" type="button" (click)="editar()" [disabled]="!rutina">Editar rutina</button>
      <button class="btn ghost" type="button" (click)="eliminar()" [disabled]="!rutina">Eliminar</button>
      <button class="btn primary" type="button" (click)="ejecutar()" [disabled]="!rutina?.id">Iniciar entrenamiento</button>
    </div>
  </header>

  <p class="alert error" *ngIf="error">{{ error }}</p>
  <p class="alert muted" *ngIf="cargando && !error">Cargando datos...</p>

  <section *ngIf="rutina as r" class="detalle__grid">
    <div class="panel">
      <h2>Descripcion</h2>
      <p class="descripcion">{{ r.detalle.descripcion || 'Sin descripcion' }}</p>
      <div class="tags">
        <span class="tag">Descanso: {{ descansoSeg }}s</span>
        <span class="tag" *ngIf="r.esGlobal">Plantilla global</span>
      </div>
    </div>

    <div class="panel image" *ngIf="r.detalle.imagen">
      <img [src]="r.detalle.imagen" [alt]="r.nombre">
    </div>
  </section>

  <section *ngIf="ejercicios.length" class="panel ejercicios">
    <header class="subheader">
      <div>
        <p class="kicker">Ejercicios</p>
        <h3>Contenido de la rutina</h3>
      </div>
      <span class="muted">{{ ejercicios.length }} ejercicios - Usa las flechas para reordenar</span>
    </header>

    <div class="ejercicio" *ngFor="let ej of ejercicios; let i = index">
      <div class="ejercicio__info">
        <div class="orden-badges">
          <span class="pill">#{{ i + 1 }}</span>
          <button class="btn ghost tiny" type="button" (click)="moverEjercicio(i, 'up')" [disabled]="i === 0">Subir</button>
          <button class="btn ghost tiny" type="button" (click)="moverEjercicio(i, 'down')" [disabled]="i === ejercicios.length - 1">Bajar</button>
        </div>
        <div>
          <p class="ejercicio__nombre">{{ ej.ejercicio }}</p>
          <p class="muted">Series: {{ ej.series.length || 0 }}</p>
        </div>
      </div>
      <div class="series">
        <div class="serie" *ngFor="let s of ej.series">
          <span class="pill">Carga: {{ s.carga }}</span>
          <span class="pill">Reps: {{ s.repeticiones }}</span>
          <span class="pill">Orden: {{ s.orden }}</span>
        </div>
      </div>
    </div>
  </section>

  <section *ngIf="rutina && !(rutina.detalle?.ejercicios?.length)" class="panel">
    <p class="muted">Esta rutina aun no tiene ejercicios asignados.</p>
  </section>
</section>
